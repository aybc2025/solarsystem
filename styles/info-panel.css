// ××—×œ×§×ª ×¤×× ×œ ××™×“×¢ ×¢×œ ×›×•×›×‘×™ ×”×œ×›×ª - ××ª×•×§× ×ª ×•××©×•×¤×¨×ª
class InfoPanel {
    constructor() {
        this.app = null;
        this.isVisible = false;
        this.currentPlanet = null;
        
        // ××œ×× ×˜×™×
        this.elements = {
            panel: null,
            header: null,
            title: null,
            closeButton: null,
            content: null,
            preview: null,
            data: null,
            dataElements: new Map()
        };
        
        // ×× ×™××¦×™×•×ª
        this.animations = {
            planetRotation: null,
            fadeIn: null,
            fadeOut: null
        };
        
        this.isInitialized = false;
    }

    // ××ª×—×•×œ ×”×¤×× ×œ
    async init(app) {
        try {
            this.app = app;
            
            // ××™×ª×•×¨ ××• ×™×¦×™×¨×ª ××œ×× ×˜×™×
            await this.findOrCreateElements();
            
            // ×”×’×“×¨×ª ×××–×™× ×™ ××™×¨×•×¢×™×
            this.setupEventListeners();
            
            // ×”×›× ×ª ×× ×™××¦×™×•×ª
            this.setupAnimations();
            
            this.isInitialized = true;
            console.log('âœ… Info Panel initialized successfully');
            
        } catch (error) {
            console.error('âŒ Failed to initialize Info Panel:', error);
            throw error;
        }
    }

    // ××™×ª×•×¨ ××• ×™×¦×™×¨×ª ××œ×× ×˜×™×
    async findOrCreateElements() {
        // ×—×™×¤×•×© ×¤×× ×œ ×§×™×™×
        this.elements.panel = document.getElementById('infoPanel');
        
        // ×™×¦×™×¨×ª ×¤×× ×œ ×× ×œ× ×§×™×™×
        if (!this.elements.panel) {
            await this.createInfoPanel();
        }
        
        // ××™×ª×•×¨ ××œ×× ×˜×™× ×¤× ×™××™×™×
        this.elements.header = this.elements.panel.querySelector('.info-header');
        this.elements.title = document.getElementById('planetName');
        this.elements.closeButton = this.elements.panel.querySelector('.close-btn');
        this.elements.content = this.elements.panel.querySelector('.info-content');
        this.elements.preview = document.getElementById('planetPreview');
        this.elements.data = document.getElementById('planetData');
        
        // ××™×ª×•×¨ ××œ×× ×˜×™ × ×ª×•× ×™×
        const dataIds = ['planetDistance', 'planetMass', 'planetRadius', 'planetPeriod', 'temperature'];
        dataIds.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                this.elements.dataElements.set(id, element);
            }
        });
        
        if (!this.elements.panel) {
            throw new Error('Info panel element not found and could not be created');
        }
    }

    // **×”×•×¡×¤×”: ×™×¦×™×¨×ª ×¤×× ×œ ××™×“×¢**
    async createInfoPanel() {
        const panel = document.createElement('div');
        panel.id = 'infoPanel';
        panel.className = 'hidden';
        panel.innerHTML = `
            <div class="info-header">
                <h3 id="planetName">××™×“×¢ ×¢×œ ×›×•×›×‘ ×”×œ×›×ª</h3>
                <button class="close-btn" title="×¡×’×•×¨">&times;</button>
            </div>
            <div class="info-content">
                <div id="planetPreview" class="planet-image"></div>
                <div id="planetData" class="planet-data"></div>
            </div>
        `;
        
        document.body.appendChild(panel);
        this.elements.panel = panel;
        
        console.log('Info panel created');
    }

    // ×”×’×“×¨×ª ×××–×™× ×™ ××™×¨×•×¢×™×
    setupEventListeners() {
        // ×›×¤×ª×•×¨ ×¡×’×™×¨×”
        if (this.elements.closeButton) {
            this.elements.closeButton.addEventListener('click', () => {
                this.hide();
            });
        }
        
        // ×œ×—×™×¦×” ××—×•×¥ ×œ×¤×× ×œ (×¢×œ ×”×¨×§×¢)
        if (this.elements.panel) {
            this.elements.panel.addEventListener('click', (event) => {
                if (event.target === this.elements.panel) {
                    this.hide();
                }
            });
        }
        
        // ××§×© Escape
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Escape' && this.isVisible) {
                this.hide();
            }
        });
        
        // **×”×•×¡×¤×”: ××™×¨×•×¢×™ ××¤×œ×™×§×¦×™×”**
        if (this.app) {
            // ×”××–× ×” ×œ×‘×—×™×¨×ª ×›×•×›×‘ ×œ×›×ª
            if (typeof this.app.on === 'function') {
                this.app.on('planetSelected', (data) => {
                    this.showPlanetInfo(data.planet);
                });
                
                this.app.on('planetDeselected', () => {
                    this.hide();
                });
            }
        }
    }

    // ×”×›× ×ª ×× ×™××¦×™×•×ª
    setupAnimations() {
        // ×× ×™××¦×™×™×ª ×¡×™×‘×•×‘ ×›×•×›×‘ ×”×œ×›×ª ×‘×ª×¦×•×’×” ××§×“×™××”
        if (this.elements.preview) {
            this.animations.planetRotation = {
                angle: 0,
                speed: 0.01,
                active: false
            };
        }
        
        // ×”×’×“×¨×ª ×× ×™××¦×™×•×ª CSS
        this.setupCSSAnimations();
    }

    // **×”×•×¡×¤×”: ×”×’×“×¨×ª ×× ×™××¦×™×•×ª CSS**
    setupCSSAnimations() {
        if (!this.elements.panel) return;
        
        // ×× ×™××¦×™×™×ª ×›× ×™×¡×”
        this.animations.fadeIn = [
            { opacity: 0, transform: 'translate(-50%, -50%) scale(0.8)' },
            { opacity: 1, transform: 'translate(-50%, -50%) scale(1)' }
        ];
        
        // ×× ×™××¦×™×™×ª ×™×¦×™××”
        this.animations.fadeOut = [
            { opacity: 1, transform: 'translate(-50%, -50%) scale(1)' },
            { opacity: 0, transform: 'translate(-50%, -50%) scale(0.8)' }
        ];
    }

    // **×¢×“×›×•×Ÿ: ×”×¦×’×ª ××™×“×¢ ×¢×œ ×›×•×›×‘ ×œ×›×ª**
    showPlanetInfo(planetName) {
        const planetData = PLANETS_DATA[planetName];
        if (!planetData || !this.elements.panel) {
            console.warn('Cannot show planet info:', planetName);
            return;
        }
        
        this.currentPlanet = planetName;
        this.isVisible = true;
        
        // ×¢×“×›×•×Ÿ ×›×•×ª×¨×ª
        if (this.elements.title) {
            this.elements.title.textContent = planetData.name;
        }
        
        // ×¢×“×›×•×Ÿ ×ª×•×›×Ÿ
        this.updateContent(planetName, planetData);
        
        // ×”×¦×’×ª ×”×¤×× ×œ ×¢× ×× ×™××¦×™×”
        this.show();
        
        console.log(`Showing info for: ${planetData.name}`);
    }

    // **×¢×“×›×•×Ÿ: ×¢×“×›×•×Ÿ ×ª×•×›×Ÿ ×”×¤×× ×œ**
    updateContent(planetName, planetData) {
        // ×¢×“×›×•×Ÿ ×ª×¦×•×’×” ××§×“×™××”
        this.updatePreview(planetName, planetData);
        
        // ×¢×“×›×•×Ÿ × ×ª×•× ×™×
        this.updateData(planetName, planetData);
    }

    // **×¢×“×›×•×Ÿ: ×ª×¦×•×’×” ××§×“×™××”**
    updatePreview(planetName, planetData) {
        if (!this.elements.preview) return;
        
        const color = planetData.color ? `#${planetData.color.toString(16).padStart(6, '0')}` : '#888888';
        const darkerColor = this.darkenColor(color, 0.4);
        
        let previewHTML = `
            <div class="planet-sphere" style="
                background: radial-gradient(circle at 30% 30%, ${color}, ${darkerColor});
                box-shadow: inset -20px -20px 50px rgba(0,0,0,0.5), 0 0 20px ${color}40;
            ">
        `;
        
        // ×˜×‘×¢×•×ª ××™×•×—×“×•×ª ×œ×©×‘×ª××™
        if (planetName === 'saturn') {
            previewHTML += `
                <div class="saturn-rings" style="
                    border-color: rgba(245, 245, 220, 0.6);
                    animation: ringRotate 30s linear infinite;
                "></div>
            `;
        }
        
        // ××˜××•×¡×¤×™×¨×” ×œ×›×•×›×‘×™ ×œ×›×ª ××ª××™××™×
        if (['venus', 'earth', 'mars', 'jupiter', 'saturn', 'uranus', 'neptune'].includes(planetName)) {
            const atmosphereColor = this.getAtmosphereColor(planetName);
            previewHTML += `
                <div style="
                    position: absolute;
                    top: -10px; left: -10px; right: -10px; bottom: -10px;
                    border-radius: 50%;
                    background: ${atmosphereColor};
                    opacity: 0.3;
                    pointer-events: none;
                "></div>
            `;
        }
        
        previewHTML += '</div>';
        this.elements.preview.innerHTML = previewHTML;
    }

    // **×”×•×¡×¤×”: ×§×‘×œ×ª ×¦×‘×¢ ××˜××•×¡×¤×™×¨×”**
    getAtmosphereColor(planetName) {
        const atmosphereColors = {
            venus: 'radial-gradient(circle, #FFF5AA, transparent)',
            earth: 'radial-gradient(circle, #87CEEB, transparent)',
            mars: 'radial-gradient(circle, #DEB887, transparent)',
            jupiter: 'radial-gradient(circle, #F4A460, transparent)',
            saturn: 'radial-gradient(circle, #F5DEB3, transparent)',
            uranus: 'radial-gradient(circle, #40E0D0, transparent)',
            neptune: 'radial-gradient(circle, #4169E1, transparent)'
        };
        
        return atmosphereColors[planetName] || 'radial-gradient(circle, #CCCCCC, transparent)';
    }

    // ×¢×“×›×•×Ÿ × ×ª×•× ×™×
    updateData(planetName, planetData) {
        if (!this.elements.data) return;
        
        // ×™×¦×™×¨×ª ×ª×•×›×Ÿ ××¤×•×¨×˜
        const content = this.generateDetailedContent(planetName, planetData);
        this.elements.data.innerHTML = content;
    }

    // **×”×•×¡×¤×”: ×™×¦×™×¨×ª ×ª×•×›×Ÿ ××¤×•×¨×˜**
    generateDetailedContent(planetName, planetData) {
        let content = `
            <div class="planet-description">
                <p>${planetData.description}</p>
            </div>
            
            <div class="planet-basic-data">
                <div class="data-item">
                    <span class="label">×¨×“×™×•×¡:</span>
                    <span class="value">${planetData.radius?.toLocaleString() || '×œ× ×™×“×•×¢'} ×§"×</span>
                </div>
        `;
        
        // × ×ª×•× ×™× ×‘×¡×™×¡×™×™×
        if (planetData.distance) {
            const distanceAU = (planetData.distance / 149597870.7).toFixed(2);
            content += `
                <div class="data-item">
                    <span class="label">××¨×—×§ ××”×©××©:</span>
                    <span class="value">${(planetData.distance / 1e6).toFixed(1)} ××™×œ×™×•×Ÿ ×§"× (${distanceAU} AU)</span>
                </div>
            `;
        }
        
        if (planetData.orbitalPeriod) {
            const years = (planetData.orbitalPeriod / 365.25).toFixed(2);
            content += `
                <div class="data-item">
                    <span class="label">×©× ×”:</span>
                    <span class="value">${planetData.orbitalPeriod.toFixed(0)} ×™××™× (${years} ×©× ×•×ª ×›×“×•×¨ ××¨×¥)</span>
                </div>
            `;
        }
        
        if (planetData.rotationPeriod) {
            const hours = (Math.abs(planetData.rotationPeriod) * 24).toFixed(1);
            const direction = planetData.rotationPeriod < 0 ? ' (×”×¤×•×š)' : '';
            content += `
                <div class="data-item">
                    <span class="label">×™×•×:</span>
                    <span class="value">${hours} ×©×¢×•×ª${direction}</span>
                </div>
            `;
        }
        
        if (planetData.temperature) {
            content += `
                <div class="data-item">
                    <span class="label">×˜××¤×¨×˜×•×¨×”:</span>
                    <span class="value">${this.formatTemperature(planetData.temperature)}</span>
                </div>
            `;
        }
        
        if (planetData.moons !== undefined) {
            content += `
                <div class="data-item">
                    <span class="label">×™×¨×—×™×:</span>
                    <span class="value">${planetData.moons}</span>
                </div>
            `;
        }
        
        content += '</div>';
        
        // ×¢×•×‘×“×•×ª ××¢× ×™×™× ×•×ª
        if (planetData.facts && planetData.facts.length > 0) {
            content += `
                <div class="interesting-facts">
                    <h4>×¢×•×‘×“×•×ª ××¢× ×™×™× ×•×ª</h4>
                    <ul>
                        ${planetData.facts.slice(0, 5).map(fact => `<li>${fact}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        // ×”×©×•×•××” ×œ×›×“×•×¨ ×”××¨×¥ (×× ×œ× ×›×“×•×¨ ×”××¨×¥ ×¢×¦××•)
        if (planetName !== 'earth' && planetName !== 'sun') {
            content += this.generateEarthComparison(planetName, planetData);
        }
        
        // ××™×“×¢ ×¢×œ ×™×¨×—×™× ×¢×™×§×¨×™×™×
        if (planetData.majorMoons && planetData.majorMoons.length > 0) {
            content += `
                <div class="moons-info">
                    <h4>×™×¨×—×™× ×¢×™×§×¨×™×™×</h4>
                    <div class="moons-list">
                        ${planetData.majorMoons.map(moon => `<span class="moon-item">${moon}</span>`).join('')}
                    </div>
                </div>
            `;
        }
        
        // ×—×§×™×¨×” ×—×œ×œ×™×ª
        if (planetData.exploration && planetData.exploration.length > 0) {
            content += `
                <div class="exploration-info">
                    <h4>×—×§×™×¨×” ×—×œ×œ×™×ª</h4>
                    <ul class="exploration-list">
                        ${planetData.exploration.map(mission => `<li>${mission}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        return content;
    }

    // **×”×•×¡×¤×”: ×”×©×•×•××” ×œ×›×“×•×¨ ×”××¨×¥**
    generateEarthComparison(planetName, planetData) {
        const earthData = PLANETS_DATA.earth;
        let content = '<div class="earth-comparison"><h4>×”×©×•×•××” ×œ×›×“×•×¨ ×”××¨×¥</h4><div class="comparison-grid">';
        
        // ×”×©×•×•××ª ×’×•×“×œ
        if (planetData.radius && earthData.radius) {
            const ratio = planetData.radius / earthData.radius;
            const comparison = ratio > 1 ? 
                `×’×“×•×œ ×¤×™ ${ratio.toFixed(1)}` : 
                `×§×˜×Ÿ ×¤×™ ${(1/ratio).toFixed(1)}`;
            
            content += `
                <div class="comparison-item">
                    <span class="label">×’×•×“×œ:</span>
                    <span class="value">${comparison}</span>
                </div>
            `;
        }
        
        // ×”×©×•×•××ª ××¡×”
        if (planetData.mass && earthData.mass) {
            const massRatio = planetData.mass / earthData.mass;
            const massComparison = massRatio > 1 ? 
                `×›×‘×“ ×¤×™ ${massRatio.toFixed(1)}` : 
                `×§×œ ×¤×™ ${(1/massRatio).toFixed(1)}`;
            
            content += `
                <div class="comparison-item">
                    <span class="label">××¡×”:</span>
                    <span class="value">${massComparison}</span>
                </div>
            `;
        }
        
        // ×”×©×•×•××ª ×©× ×”
        if (planetData.orbitalPeriod && earthData.orbitalPeriod) {
            const yearRatio = planetData.orbitalPeriod / earthData.orbitalPeriod;
            const yearComparison = yearRatio > 1 ? 
                `××¨×•×›×” ×¤×™ ${yearRatio.toFixed(1)}` : 
                `×§×¦×¨×” ×¤×™ ${(1/yearRatio).toFixed(1)}`;
            
            content += `
                <div class="comparison-item">
                    <span class="label">×©× ×”:</span>
                    <span class="value">${yearComparison}</span>
                </div>
            `;
        }
        
        // ×”×©×•×•××ª ×™×•×
        if (planetData.rotationPeriod && earthData.rotationPeriod) {
            const dayRatio = Math.abs(planetData.rotationPeriod) / earthData.rotationPeriod;
            const dayComparison = dayRatio > 1 ? 
                `××¨×•×š ×¤×™ ${dayRatio.toFixed(1)}` : 
                `×§×¦×¨ ×¤×™ ${(1/dayRatio).toFixed(1)}`;
            
            content += `
                <div class="comparison-item">
                    <span class="label">×™×•×:</span>
                    <span class="value">${dayComparison}</span>
                </div>
            `;
        }
        
        content += '</div></div>';
        return content;
    }

    // ×¤×•×¨××˜ ×˜××¤×¨×˜×•×¨×”
    formatTemperature(temp) {
        if (typeof temp === 'number') {
            return `${temp}Â°C`;
        } else if (typeof temp === 'object' && temp !== null) {
            if (temp.avg !== undefined) return `${temp.avg}Â°C ×××•×¦×¢`;
            if (temp.surface !== undefined) return `${temp.surface}Â°C ×¤× ×™ ×”×©×˜×—`;
            if (temp.min !== undefined && temp.max !== undefined) {
                return `${temp.min}Â°C ×¢×“ ${temp.max}Â°C`;
            }
            if (temp.day !== undefined && temp.night !== undefined) {
                return `×™×•×: ${temp.day}Â°C, ×œ×™×œ×”: ${temp.night}Â°C`;
            }
        }
        return '×œ× ×™×“×•×¢';
    }

    // ×”×—×©×›×ª ×¦×‘×¢
    darkenColor(color, factor) {
        const hex = color.replace('#', '');
        const r = Math.max(0, Math.floor(parseInt(hex.substr(0, 2), 16) * (1 - factor)));
        const g = Math.max(0, Math.floor(parseInt(hex.substr(2, 2), 16) * (1 - factor)));
        const b = Math.max(0, Math.floor(parseInt(hex.substr(4, 2), 16) * (1 - factor)));
        
        return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
    }

    // ×”×¦×’×ª ×”×¤×× ×œ
    show() {
        if (!this.elements.panel) return;
        
        // ×”×¡×¨×ª ××—×œ×§×ª hidden
        this.elements.panel.classList.remove('hidden');
        
        // ×”×•×¡×¤×ª ××—×œ×§×ª ×¦×‘×¢ ×œ×¤×™ ×›×•×›×‘ ×”×œ×›×ª
        if (this.currentPlanet) {
            this.elements.panel.className = `planet-${this.currentPlanet}`;
        }
        
        // ×× ×™××¦×™×™×ª ×›× ×™×¡×”
        if (this.animations.fadeIn && this.elements.panel.animate) {
            this.elements.panel.animate(this.animations.fadeIn, {
                duration: 300,
                easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
            });
        }
        
        this.isVisible = true;
        
        // ×”×ª×—×œ×ª ×× ×™××¦×™×™×ª ×¡×™×‘×•×‘ ×× ×™×© ×ª×¦×•×’×” ××§×“×™××”
        this.startPlanetAnimation();
        
        console.log('Info panel shown');
    }

    // ×”×¡×ª×¨×ª ×”×¤×× ×œ
    hide() {
        if (!this.elements.panel) return;
        
        // ×× ×™××¦×™×™×ª ×™×¦×™××”
        if (this.animations.fadeOut && this.elements.panel.animate) {
            const animation = this.elements.panel.animate(this.animations.fadeOut, {
                duration: 200,
                easing: 'ease-in'
            });
            
            animation.addEventListener('finish', () => {
                this.elements.panel.classList.add('hidden');
            });
        } else {
            this.elements.panel.classList.add('hidden');
        }
        
        this.isVisible = false;
        this.currentPlanet = null;
        
        // ×¢×¦×™×¨×ª ×× ×™××¦×™×•×ª
        this.stopPlanetAnimation();
        
        console.log('Info panel hidden');
    }

    // **×”×•×¡×¤×”: ×”×ª×—×œ×ª ×× ×™××¦×™×™×ª ×›×•×›×‘ ×”×œ×›×ª**
    startPlanetAnimation() {
        if (this.animations.planetRotation) {
            this.animations.planetRotation.active = true;
            this.animatePlanetRotation();
        }
    }

    // **×”×•×¡×¤×”: ×¢×¦×™×¨×ª ×× ×™××¦×™×™×ª ×›×•×›×‘ ×”×œ×›×ª**
    stopPlanetAnimation() {
        if (this.animations.planetRotation) {
            this.animations.planetRotation.active = false;
        }
    }

    // **×”×•×¡×¤×”: ×× ×™××¦×™×™×ª ×¡×™×‘×•×‘ ×›×•×›×‘ ×”×œ×›×ª**
    animatePlanetRotation() {
        if (!this.animations.planetRotation.active) return;
        
        const planetSphere = this.elements.preview?.querySelector('.planet-sphere');
        if (planetSphere) {
            this.animations.planetRotation.angle += this.animations.planetRotation.speed;
            planetSphere.style.transform = `rotate(${this.animations.planetRotation.angle}rad)`;
        }
        
        if (this.animations.planetRotation.active) {
            requestAnimationFrame(() => this.animatePlanetRotation());
        }
    }

    // ×‘×“×™×§×” ×× ×”×¤×× ×œ ×’×œ×•×™
    isShowing() {
        return this.isVisible;
    }

    // ×§×‘×œ×ª ×›×•×›×‘ ×”×œ×›×ª ×”× ×•×›×—×™
    getCurrentPlanet() {
        return this.currentPlanet;
    }

    // **×”×•×¡×¤×”: ×”×—×œ×¤×ª ×›×•×›×‘ ×œ×›×ª ×‘×œ×™ ×¡×’×™×¨×ª ×”×¤×× ×œ**
    switchPlanet(newPlanetName) {
        if (this.isVisible) {
            this.showPlanetInfo(newPlanetName);
        }
    }

    // **×”×•×¡×¤×”: ×¢×“×›×•×Ÿ ××™×§×•× ×”×¤×× ×œ**
    updatePosition(x, y) {
        if (this.elements.panel && x !== undefined && y !== undefined) {
            this.elements.panel.style.left = `${x}px`;
            this.elements.panel.style.top = `${y}px`;
            this.elements.panel.style.transform = 'translate(-50%, -50%)';
        }
    }

    // **×”×•×¡×¤×”: ×”×’×“×¨×ª ×’×•×“×œ ×”×¤×× ×œ**
    setSize(width, height) {
        if (this.elements.panel) {
            if (width) this.elements.panel.style.width = typeof width === 'number' ? `${width}px` : width;
            if (height) this.elements.panel.style.height = typeof height === 'number' ? `${height}px` : height;
        }
    }

    // ×§×‘×œ×ª ××™×“×¢ ××”×™×¨
    getQuickInfo(planetName) {
        const planetData = PLANETS_DATA[planetName];
        if (!planetData) return null;
        
        return {
            name: planetData.name,
            nameEn: planetData.nameEn,
            description: planetData.description,
            quickFacts: planetData.facts?.slice(0, 3) || [],
            color: planetData.color,
            radius: planetData.radius,
            distance: planetData.distance
        };
    }

    // ×¢×“×›×•×Ÿ ××¦×‘ ××”××¤×œ×™×§×¦×™×”
    syncWithApp() {
        if (this.app && this.app.state) {
            if (this.app.state.selectedPlanet && this.app.state.selectedPlanet !== this.currentPlanet) {
                this.showPlanetInfo(this.app.state.selectedPlanet);
            }
        }
    }

    // × ×™×§×•×™ ××©××‘×™×
    dispose() {
        // ×¢×¦×™×¨×ª ×× ×™××¦×™×•×ª
        this.stopPlanetAnimation();
        
        // ×”×¡×ª×¨×ª ×”×¤×× ×œ
        this.hide();
        
        // × ×™×§×•×™ ×”×¤× ×™×•×ª
        this.currentPlanet = null;
        this.isVisible = false;
        this.app = null;
        
        // × ×™×§×•×™ ××œ×× ×˜×™×
        Object.keys(this.elements).forEach(key => {
            if (key !== 'dataElements') {
                this.elements[key] = null;
            }
        });
        this.elements.dataElements.clear();
        
        this.isInitialized = false;
        
        console.log('Info panel disposed');
    }
}

// **×”×•×¡×¤×”: ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×’×œ×•×‘×œ×™×•×ª**
const InfoPanelUtils = {
    // ×™×¦×™×¨×ª ×ª×•×›×Ÿ ××”×™×¨ ×œ××™×“×¢ ×¢×œ ×›×•×›×‘ ×œ×›×ª
    createQuickContent(planetName) {
        const planetData = PLANETS_DATA[planetName];
        if (!planetData) return '';
        
        return `
            <div class="quick-info">
                <h3>${planetData.name}</h3>
                <p>${planetData.description}</p>
                ${planetData.facts ? `
                    <ul>
                        ${planetData.facts.slice(0, 2).map(fact => `<li>${fact}</li>`).join('')}
                    </ul>
                ` : ''}
            </div>
        `;
    },
    
    // ×¤×•×¨××˜ ××¡×¤×¨×™× ×’×“×•×œ×™×
    formatLargeNumber(num) {
        if (num >= 1e9) return (num / 1e9).toFixed(1) + ' ××™×œ×™××¨×“';
        if (num >= 1e6) return (num / 1e6).toFixed(1) + ' ××™×œ×™×•×Ÿ';
        if (num >= 1e3) return (num / 1e3).toFixed(1) + ' ××œ×£';
        return num.toLocaleString();
    },
    
    // ×§×‘×œ×ª ××™×™×§×•×Ÿ ×œ×›×•×›×‘ ×œ×›×ª
    getPlanetIcon(planetName) {
        const icons = {
            sun: 'â˜€ï¸',
            mercury: 'â˜¿ï¸',
            venus: 'â™€ï¸',
            earth: 'ğŸŒ',
            mars: 'â™‚ï¸',
            jupiter: 'â™ƒ',
            saturn: 'â™„',
            uranus: 'â™…',
            neptune: 'â™†'
        };
        
        return icons[planetName] || 'ğŸª';
    }
};

// ×”×¤×•×š ×”×›×œ ×–××™×Ÿ ×’×œ×•×‘×œ×™×ª
if (typeof window !== 'undefined') {
    window.InfoPanel = InfoPanel;
    window.InfoPanelUtils = InfoPanelUtils;
    
    // ×™×¦×™×¨×ª instance ×’×œ×•×‘×œ×™
    window.infoPanel = new InfoPanel();
}
